# Story 5.3: Selected Device Status and Parameters

**Epic:** [Epic 5: Enhance MCP `status` Command](../epic-5.md)

**User Story:**

*   As an AI agent, I want to get information about the currently selected device (track context, device index, name, bypass status, and its parameters), so I can understand and control the selected device.

**Depends on:** [Story 5.1](./5.1.story.md)

**Acceptance Criteria:**

*   The `status` MCP command response, in addition to fields from 5.1, includes:
    *   A `selected_device` object (or null if no device is selected/applicable) containing:
        *   `track_name` (string, name of the track the device is on)
        *   `track_index` (integer, index of the track the device is on)
        *   `index` (integer, 0-based index of the device in the track's device chain)
        *   `name` (string)
        *   `bypassed` (boolean)
        *   `parameters` (array of objects), where each object contains:
            *   `index` (integer, 0-7)
            *   `name` (string, null if parameter doesn't exist for that index)
            *   `value` (float, normalized 0.0-1.0, null if parameter doesn't exist)
            *   `display_value` (string, null if parameter doesn't exist)
            *   Only parameters that exist/are accessible are included.
*   The `StatusTool.java` correctly queries the Bitwig API for selected device details (e.g., via `CursorDevice` and its associated `RemoteControlsPage`).
*   The `api-reference.md` is updated to reflect these new fields.
*   The tool gracefully handles cases where no device is selected (`selected_device` should be null) or a device has no parameters (parameters array should be empty).

**Tasks:**

1.  Modify `StatusTool.java` to fetch selected device details: `track_name`, `track_index`, `index` (device index in chain), `name`, `bypassed`.
2.  Modify `StatusTool.java` to fetch the parameters of the selected device, similar to how `get_selected_device_parameters` works but integrated here.
3.  Update the JSON construction in `StatusTool.java` to include the `selected_device` object and its nested `parameters` array.
4.  Update `docs/api-reference.md` with the new response fields for this story.
5.  Write unit tests for the new data retrieval logic.
6.  Perform manual testing against Bitwig Studio, including scenarios with no device selected and devices with varying numbers of parameters.
